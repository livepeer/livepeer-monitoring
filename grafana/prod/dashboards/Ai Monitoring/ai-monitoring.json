{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "loki",
        "uid": "P8E80F9AEF21F6940"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 47,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": false,
        "sortOrder": "Descending",
        "wrapLogMessage": false
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "P8E80F9AEF21F6940"
          },
          "direction": "backward",
          "editorMode": "code",
          "expr": "{container=~\"ai-gateway|live-video-to-video_comfyui_.*\"} |~ \"${stream_key}|${stream_id}\" != \"Sending input frame\" != \"message=frame_type=Video\" != \"message=Output image received\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "Panel Title",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 8,
      "panels": [],
      "title": "Stream Monitoring - Ingest",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This dashboard show the average of stream start-up time that is successful in seconds.\nThe average is coming for the Start Up dashboard below.\n\nGreen = Avg < 6 seconds\nYellow = Avg 6 - 10 seconds\nRed = Avg > 12 seconds.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "red",
                "value": 12
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 0,
        "y": 9
      },
      "id": 44,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": true,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  toFloat64(median(source.total_time_diff_ms)) / 1000.0 AS `Start Up Time Seconds`\nFROM\n  (\n    SELECT\n      network_events.stream_trace_summary_view.total_time_diff_ms AS total_time_diff_ms\n    FROM\n      network_events.stream_trace_summary_view\n    WHERE\n      $__timeFilter(first_event_timestamp_ts)\n  ) AS source",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.8.2",
          "queryType": "table",
          "rawSql": "WITH all_subtypes AS (\n    SELECT 'app_receive_first_segment' AS sub_type\n    UNION ALL SELECT 'gateway_receive_stream_request'  \n    UNION ALL SELECT 'gateway_send_first_ingest_segment'\n    UNION ALL SELECT 'runner_receive_first_ingest_segment'\n),\nstream_events AS (\n    SELECT\n        stream_id,\n        sub_type,\n        timestamp_ts,\n        time_diff_ms / 1000.0 AS time_diff_seconds\n    FROM network_events.stream_trace\n    WHERE sub_type IN (SELECT sub_type FROM all_subtypes)\n    AND timestamp_ts BETWEEN toDateTime($__from/1000) AND toDateTime($__to/1000)\n),\nstream_times AS (\n    SELECT\n        stream_id,\n        MIN(CASE WHEN sub_type = 'gateway_receive_stream_request' THEN timestamp_ts END) AS start_time,\n        MAX(CASE WHEN sub_type = 'app_receive_first_segment' THEN timestamp_ts END) AS end_time\n    FROM stream_events\n    GROUP BY stream_id\n    HAVING start_time IS NOT NULL AND end_time IS NOT NULL\n)\n\n-- 1. Total Startup Time (Gateway Request â†’ App Receive)\nSELECT\n    'Total Startup Time' AS metric,\n    ROUND(COALESCE(AVG(toUnixTimestamp(end_time) - toUnixTimestamp(start_time)), 0), 3) AS `Seconds`\nFROM stream_times\n\nUNION ALL\n\n-- 2. Individual Subtype Averages\nSELECT\n    sub_type AS metric,\n    ROUND(AVG(time_diff_seconds), 3) AS `Seconds`\nFROM stream_events\nGROUP BY sub_type\n\nUNION ALL\n\n-- 3. TRUE Combined Average (All Events - Weighted)\nSELECT\n    'Combined Average (Weighted)' AS metric,\n    ROUND(AVG(time_diff_seconds), 3) AS `Seconds`\nFROM stream_events\n\nUNION ALL\n\n-- 4. Corrected Average of Subtype Averages (Unweighted)\nSELECT\n    'Combined Average (Unweighted)' AS metric,\n    ROUND(SUM(subtype_avg) / COUNT(DISTINCT sub_type), 3) AS `Seconds`\nFROM (\n    SELECT sub_type, AVG(time_diff_seconds) AS subtype_avg\n    FROM stream_events\n    GROUP BY sub_type\n) AS sub_avg_table;",
          "refId": "B"
        }
      ],
      "title": "Average Start Up Time",
      "type": "stat"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This chart indicates the percentage of streams that experience errors.\n\nGreen = < 10% of streams with errors\nYellow = > 10% of streams with errors\nRed = > 20% of streams with errors",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "red",
                "value": 20
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 4,
        "y": 9
      },
      "id": 34,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "text": {
          "titleSize": 1
        },
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  SUM(CASE WHEN last_error_time_ts IS NOT NULL THEN 1 ELSE 0 END) / COUNT(*) * 100 AS `Error Percentage`\nFROM (\n  SELECT\n    stream_id,\n    MAX(last_error_time_ts) AS last_error_time_ts\n  FROM\n    network_events.stream_status_view\n  WHERE\n    $__timeFilter(timestamp_ts)\n  GROUP BY\n    stream_id\n) AS stream_errors",
          "refId": "A"
        }
      ],
      "title": "Stream w/ Errors",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This monitors the full start up success rate.\n\nGreen = > 95% success rate\nYellow= > 80% success rate\nRed= < 80% success rate",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "semi-dark-red"
              },
              {
                "color": "#EAB839",
                "value": 0.8
              },
              {
                "color": "dark-green",
                "value": 0.95
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 8,
        "y": 9
      },
      "id": 45,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  CASE\n    WHEN count() > 0 THEN SUM(\n      CASE\n        WHEN source.gateway_startup_completed = 1 THEN 1\n        ELSE 0\n      END\n    )\n    ELSE NULL\n  END / COUNT(*) AS `Gateway Start Up Success`\nFROM\n  (\n    SELECT\n      network_events.stream_trace_summary_view.gateway_startup_completed AS gateway_startup_completed\n    FROM\n      network_events.stream_trace_summary_view\n    WHERE\n      $__timeFilter(first_event_timestamp_ts)\n  ) AS source",
          "refId": "A"
        }
      ],
      "title": "Gateway Start Up Success Rate",
      "type": "stat"
    },
    {
      "datasource": {
        "default": true,
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "description": "Provides information on the number of AI livestreams currently live in production.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "# of Active Streams",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 11,
        "x": 13,
        "y": 9
      },
      "id": 25,
      "options": {
        "legend": {
          "calcs": [
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "editorMode": "code",
          "expr": "sum(sum_over_time(livepeer_ai_current_live_pipelines{livepeer_node_type=\"prod-livepeer-ai-gateway\"}[30s]))",
          "instant": false,
          "interval": "",
          "legendFormat": "# of Streams",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Total Stream Counts",
      "type": "timeseries"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "The chart show the average number of seconds spent for each of the event.\n- gateway_recieve",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": true,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisGridShow": true,
            "axisLabel": "Average of Time in Seconds",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 15
      },
      "id": 39,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "table",
          "placement": "right",
          "showLegend": false
        },
        "orientation": "horizontal",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 100
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "WITH all_subtypes AS (\n    SELECT 'app_receive_first_segment' AS sub_type\n    UNION ALL SELECT 'gateway_recieve_stream_request' AS sub_type\n    UNION ALL SELECT 'gateway_send_first_ingest_segment' AS sub_type\n    UNION ALL SELECT 'runner_receive_first_ingest_segment' AS sub_type\n)\nSELECT\n  `all_subtypes`.`sub_type` AS `sub_type`,\n  COALESCE(`toFloat64`(AVG(`filtered_data`.`time_diff_ms`)) / 1000.0, 0) AS `Average of Time Seconds`\nFROM\n  all_subtypes\nLEFT JOIN\n  (\n    SELECT\n      `network_events`.`stream_trace_view`.`sub_type` AS `sub_type`,\n      `network_events`.`stream_trace_view`.`time_diff_ms` AS `time_diff_ms`\n    FROM\n      `network_events`.`stream_trace_view`\n    WHERE\n      (`network_events`.`stream_trace_view`.`sub_type` = 'app_receive_first_segment'\n      OR `network_events`.`stream_trace_view`.`sub_type` = 'gateway_recieve_stream_request'\n      OR `network_events`.`stream_trace_view`.`sub_type` = 'gateway_send_first_ingest_segment'\n      OR `network_events`.`stream_trace_view`.`sub_type` = 'runner_receive_first_ingest_segment')\n      AND `network_events`.`stream_trace_view`.`timestamp_ts` >= toDateTime($__from/1000)\n      AND `network_events`.`stream_trace_view`.`timestamp_ts` <= toDateTime($__to/1000)\n  ) AS `filtered_data` ON `all_subtypes`.`sub_type` = `filtered_data`.`sub_type`\nGROUP BY\n  `all_subtypes`.`sub_type`\nORDER BY\n  `all_subtypes`.`sub_type` ASC",
          "refId": "A"
        }
      ],
      "title": "Start Up Time",
      "type": "barchart"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "The chart shows the sub-type with stream Ids of the time spent for each of the event.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "sub_type"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 258
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "timestamp_ts"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 9
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "event_timestamp_ts"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 189
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "stream_id"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 188
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "time_diff_ms"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 74
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "event_order"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 95
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Pipelines__key"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 15
      },
      "id": 40,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  `source`.`timestamp` AS `timestamp`,\n  `source`.`event_timestamp_ts` AS `event_timestamp_ts`,\n  `source`.`stream_id` AS `stream_id`,\n  `source`.`sub_type` AS `sub_type`,\n  `source`.`time_diff_ms` AS `time_diff_ms`,\n  `source`.`request_id` AS `request_id`,\n  `source`.`Pipelines__name` AS `Pipelines__name`,\n  `source`.`pipeline_id` AS `pipeline_id`,\n  `source`.`event_timestamp` AS `event_timestamp`,\n  `source`.`last_timestamp` AS `last_timestamp`,\n  `source`.`event_order` AS `event_order`,\n  `source`.`orch_address` AS `orch_address`,\n  `source`.`orch_url` AS `orch_url`,\n  `source`.`Pipelines__key` AS `Pipelines__key`,\n  `source`.`Pipelines__author` AS `Pipelines__author`\nFROM\n  (\n    SELECT\n      `network_events`.`stream_trace_view`.`timestamp` AS `timestamp`,\n      `network_events`.`stream_trace_view`.`event_timestamp_ts` AS `event_timestamp_ts`,\n      `network_events`.`stream_trace_view`.`sub_type` AS `sub_type`,\n      `network_events`.`stream_trace_view`.`stream_id` AS `stream_id`,\n      `network_events`.`stream_trace_view`.`request_id` AS `request_id`,\n      `network_events`.`stream_trace_view`.`pipeline_id` AS `pipeline_id`,\n      `network_events`.`stream_trace_view`.`event_timestamp` AS `event_timestamp`,\n      `network_events`.`stream_trace_view`.`last_timestamp` AS `last_timestamp`,\n      `network_events`.`stream_trace_view`.`event_order` AS `event_order`,\n      `network_events`.`stream_trace_view`.`orch_address` AS `orch_address`,\n      `network_events`.`stream_trace_view`.`orch_url` AS `orch_url`,\n      `network_events`.`stream_trace_view`.`time_diff_ms` AS `time_diff_ms`,\n      `Pipelines`.`key` AS `Pipelines__key`,\n      `Pipelines`.`name` AS `Pipelines__name`,\n      `Pipelines`.`author` AS `Pipelines__author`\n    FROM\n      `network_events`.`stream_trace_view`\n     \nLEFT JOIN `network_events`.`daydream_pipelines_latest_table` AS `Pipelines` ON `network_events`.`stream_trace_view`.`pipeline_id` = `Pipelines`.`id`\n  ) AS `source`\nWHERE\n  (\n    `source`.`sub_type` = 'app_receive_first_segment'\n    OR `source`.`sub_type` = 'gateway_send_first_ingest_segment'\n    OR `source`.`sub_type` = 'runner_receive_first_ingest_segment'\n    OR `source`.`sub_type` = 'gateway_recieve_stream_request'\n  )\n \n   AND (\n    `source`.`event_timestamp_ts` >= toDateTime($__from/1000)\n  )\n  AND (\n    `source`.`event_timestamp_ts` < toDateTime($__to/1000)\n  )\n  AND (`source`.`Pipelines__key` = 'comfyui')\n  AND `source`.`stream_id` IN (${stream_id:singlequote})",
          "refId": "A"
        }
      ],
      "title": "Start Up Time with Stream Id",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This visualizes the count of'restart' and 'error' events for the latest 15 distinct streams in the network_events.stream_events dataset.\n",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left",
            "cellOptions": {
              "type": "color-text",
              "wrapText": false
            },
            "filterable": true,
            "inspect": true
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "dark-orange",
                "value": 50
              },
              {
                "color": "dark-red",
                "value": 100
              }
            ]
          },
          "unit": "none"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "restart_count"
            },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green"
                    },
                    {
                      "color": "red",
                      "value": 1
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 22
      },
      "id": 20,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "error_count"
          }
        ]
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT stream_id, \ncountIf(event_type = 'restart') AS restart_count, \ncountIf(event_type = 'error') AS error_count\nFROM \n    network_events.stream_events_view\nWHERE \n    sub_type IN ('error', 'restart')\n    AND stream_id IN (${stream_id:singlequote})\n    AND $__timeFilter(timestamp_ts)\ngroup by 1",
          "refId": "B"
        }
      ],
      "title": "Stream Error/Restart Count by Stream ID",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This chart displays the most recent events related to errors and restarts within the streaming system.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "restart_count"
            },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green"
                    },
                    {
                      "color": "red",
                      "value": 1
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 138
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "timestamp_ts"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 166
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 22
      },
      "id": 3,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "pipeline"
          }
        ]
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT \n    stream_id, \n    timestamp_ts,\n    restart_count, \n    event_type, \n    message, \n    gateway,\n    type, \n    capability, \n    pipeline, \n    pipeline_id, \n    params, \n    orchestrator_address, \n    orchestrator_url\nFROM \n    network_events.stream_events_view\nWHERE \n    sub_type IN ('error', 'restart')\n    AND stream_id IN (${stream_id:singlequote})\n    AND $__timeFilter(timestamp_ts)\n    AND pipeline = 'comfyui'\nORDER BY \n    timestamp_ts DESC\nLIMIT 100;\n",
          "refId": "A"
        }
      ],
      "title": "Stream Logs",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "loki",
        "uid": "P8E80F9AEF21F6940"
      },
      "description": "Log information of all the streams of selected streams during the gateway process.",
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 30
      },
      "id": 30,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": true,
        "showCommonLabels": true,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "P8E80F9AEF21F6940"
          },
          "direction": "backward",
          "editorMode": "code",
          "expr": "{app=~\"prod-livepeer-ai-gateway\"} |~ \"${stream_id}\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "Gateway Stream Logs",
      "type": "logs"
    },
    {
      "datasource": {
        "default": false,
        "type": "loki",
        "uid": "P8E80F9AEF21F6940"
      },
      "description": "Log information of all the streams of selected streams during the MediaMTX process.",
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 30
      },
      "id": 32,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": true,
        "showCommonLabels": true,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "P8E80F9AEF21F6940"
          },
          "editorMode": "code",
          "expr": "{app=~\"mediamtx\"} |~ \"${stream_key}\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "MediaMTX Logs",
      "type": "logs"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 38
      },
      "id": 7,
      "panels": [
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This chart visualizes the CPU usage percentage for nodes in specified regions, with a threshold set at 80%.\n\nA CPU usage percentage greater than 80% indicates that the system is heavily loaded, with most of the CPU resources actively in use.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": true,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "red",
                    "value": 50
                  },
                  {
                    "color": "dark-red",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 2
          },
          "id": 2,
          "options": {
            "legend": {
              "calcs": [
                "lastNotNull",
                "max"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "100 - (avg by (instance, region) (irate(node_cpu_seconds_total{region=~\"${region:regex}\", mode=\"idle\", instance=~\".+:9100\"}[1m])) * 100 * on(instance) group_left(nodename) node_uname_info)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}}-{{nodename}}",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "CPU Usage (> 50%)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This visualizes the count of'restart' and 'error' events for the latest 15 distinct streams in the network_events.stream_events dataset.\n",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "spanNulls": true,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "red",
                    "value": 50
                  },
                  {
                    "color": "dark-red",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 2
          },
          "id": 1,
          "options": {
            "legend": {
              "calcs": [
                "lastNotNull",
                "max"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "(node_memory_MemFree_bytes{region=~\"${region:regex}\"} + node_memory_Buffers_bytes{region=~\"${region:regex}\"} + node_memory_Cached_bytes{region=~\"${region:regex}\"}) / node_memory_MemTotal_bytes{region=~\"${region:regex}\"} * on(region) group_left(nodename) node_uname_info",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}}-{{nodename}}",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "CPU Memory Usage (> 50%)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This  indicates how much of the total disk capacity is being utilized.\n\nA higher percentage indicates that a significant portion of the disk space is in use, which may suggest that the filesystem is nearing capacity.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "max": 100,
              "min": 1,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 223
          },
          "id": 22,
          "options": {
            "legend": {
              "calcs": [
                "lastNotNull"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "(node_filesystem_size_bytes{mountpoint=\"/\", region=~\"${region:regex}\"} - node_filesystem_avail_bytes{mountpoint=\"/\", region=~\"${region:regex}\"}) / node_filesystem_size_bytes{mountpoint=\"/\", region=~\"${region:regex}\"} * 100",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}}",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Disk Usage",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This shows the disk I/O performance for various regions, specifically focusing on the rates of data being written to and read from disk.\n\nNormal Operation:-\nWhen the disk write and read rates are within expected ranges based on usage over time , the system is functioning normally. You should see stable lines on the graph, indicating consistent disk I/O performance.\n\nHigh Disk Write/Read Rates:- If the lines show significantly high values, it may indicate heavy disk usage. This could be due data ingestion processes. \n\nSudden spikes or drops in disk I/O can indicate issues that need further investigation of the node",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "decmbytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 223
          },
          "id": 21,
          "options": {
            "legend": {
              "calcs": [
                "lastNotNull"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "sum(rate(node_disk_written_bytes_total{region=~\"${region:regex}\"}[1m])) by (region) / 1000000",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}} - Disk Write",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "sum(rate(node_disk_read_bytes_total{region=~\"${region:regex}\"}[1m])) by (region) / 1000000",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}} - Disk Read",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Ingest Disk I/O Per Minute",
          "type": "timeseries"
        }
      ],
      "title": "CPU Monitoring",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 39
      },
      "id": 6,
      "panels": [
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "Number of GPUs in use and the total number of GPUs",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "dark-green"
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "count(DCGM_FI_DEV_GPU_UTIL{gpu!=\"\"} > 0)"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "GPUs in Use"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "count(DCGM_FI_DEV_POWER_USAGE{gpu!=\"\"})"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Total GPUs Available"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 9,
            "x": 0,
            "y": 3
          },
          "id": 15,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "center",
            "orientation": "vertical",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": false
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "sum(sum_over_time(livepeer_ai_container_in_use{node_type=\"orch\"}[30s]))",
              "hide": false,
              "instant": false,
              "legendFormat": "GPUs in Use",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "count(DCGM_FI_DEV_POWER_USAGE{gpu!=\"\"})",
              "hide": false,
              "instant": false,
              "legendFormat": "__auto",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "GPUs",
          "type": "stat"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "Shows how much VRAM is being used to store data and buffers",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "red",
                    "value": 50
                  },
                  {
                    "color": "dark-red",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 14,
            "x": 9,
            "y": 3
          },
          "id": 16,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "DCGM_FI_DEV_FB_USED{Hostname=~\"${Hostname:regex}\"}\n",
              "hide": false,
              "instant": false,
              "legendFormat": "{{Hostname}}/{{modelName}}",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "GPU Memory Usage",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This dashboard monitors the GPU load usage. If the threshold goes above 95% for > 15 minutes, an alert will trigger.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "percentage",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "dark-red",
                    "value": 95
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 23,
            "x": 0,
            "y": 224
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "exemplar": false,
              "expr": "sum by (\n  Hostname, \n  gpu, \n  instance, \n  modelName, \n  node_name, \n  region\n) (\n    DCGM_FI_DEV_GPU_UTIL{Hostname=~\"${Hostname:regex}\"}\n)",
              "hide": false,
              "instant": false,
              "legendFormat": "{{node_name}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GPU Utilization (> 95%)",
          "type": "timeseries"
        }
      ],
      "title": "GPU Monitoring",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 40
      },
      "id": 26,
      "panels": [],
      "title": "Inference Monitoring",
      "type": "row"
    },
    {
      "datasource": {
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This number indicates the average output of FPS.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "min": 10,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "dark-red"
              },
              {
                "color": "#EAB839",
                "value": 12
              },
              {
                "color": "dark-green",
                "value": 15
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 4,
        "x": 0,
        "y": 41
      },
      "id": 43,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  AVG(`source`.`avg`) AS `avg`\nFROM\n  (\n    SELECT\n      `network_events`.`stream_status_view`.`stream_id` AS `stream_id`,\n      AVG(`network_events`.`stream_status_view`.`output_fps`) AS `avg`\n    FROM\n      `network_events`.`stream_status_view`\n    WHERE\n      $__timeFilter(`network_events`.`stream_status_view`.`timestamp_ts`)\n    GROUP BY\n      `network_events`.`stream_status_view`.`stream_id`\n    ORDER BY\n      `network_events`.`stream_status_view`.`stream_id` ASC\n  ) AS `source`",
          "refId": "A"
        }
      ],
      "title": "AVG FPS Output",
      "type": "stat"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This dashboard monitors the average FPS output from streams.\n \n- AVG FPS  15 or greater is good.\n- AVG FPS between 10 - 15 should be monitored.\n- AVG FPS < 10 indicates an issue that needs to be investigated.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left",
            "cellOptions": {
              "type": "color-text"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "dark-red",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "dark-green",
                "value": 15
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 6,
        "x": 4,
        "y": 41
      },
      "id": 27,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  `network_events`.`stream_status_view`.`stream_id` AS `stream_id`,\n  AVG(`network_events`.`stream_status_view`.`output_fps`) AS `avg`\nFROM\n  `network_events`.`stream_status_view`\nWHERE\n  (\n    `network_events`.`stream_status_view`.`timestamp_ts` >= `toStartOfHour`((`now64`(9, 'UTC') + INTERVAL -24 hour))\n  )\n  AND (\n    `network_events`.`stream_status_view`.`timestamp_ts` < `toStartOfHour`((`now64`(9, 'UTC') + INTERVAL 1 hour))\n  )\n  AND (\n    `network_events`.`stream_status_view`.`pipeline` = 'comfyui'\n  )\n  AND (\n    `network_events`.`stream_status_view`.`stream_id` IN (${stream_id:singlequote})\n  )\nGROUP BY\n  `network_events`.`stream_status_view`.`stream_id`\nORDER BY\n  `avg` ASC,\n  `network_events`.`stream_status_view`.`stream_id` ASC;",
          "refId": "B"
        }
      ],
      "title": "Daydream: AVG FPS Output",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This table displays the number of errors for each type that is being reported.\n\nGreen = below 20 errors\nYellow = 20 - 50 errors\nRed = > 50 errors\n",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-text",
              "wrapText": false
            },
            "filterable": true,
            "inspect": false
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#EAB839",
                "value": 20
              },
              {
                "color": "red",
                "value": 50
              }
            ]
          },
          "unit": "none"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "stream_id"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 228
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "count"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 109
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "short_message"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 355
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 6,
        "x": 10,
        "y": 41
      },
      "id": 41,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n  `source`.`stream_id` AS `stream_id`,\n  `source`.`short_message` AS `short_message`,\n  COUNT(*) AS `count`\nFROM\n  (\n    SELECT\n      `network_events`.`stream_events_view`.`sub_type` AS `sub_type`,\n      `network_events`.`stream_events_view`.`timestamp_ts` AS `timestamp_ts`,\n      `network_events`.`stream_events_view`.`message` AS `message`,\n      `network_events`.`stream_events_view`.`stream_id` AS `stream_id`,\n      `substring`(\n        `toString`(`network_events`.`stream_events_view`.`message`),\n        1,\n        70\n      ) AS `short_message`\n    FROM\n      `network_events`.`stream_events_view`\n    WHERE\n      `network_events`.`stream_events_view`.`sub_type` = 'error'\n      AND $__timeFilter(timestamp_ts)\n      AND `network_events`.`stream_events_view`.`stream_id` IN (${stream_id:sqlstring})\n      AND pipeline = 'comfyui'\n  ) AS `source`\nWHERE\n  `source`.`short_message` != ''\nGROUP BY\n  `source`.`short_message`,\n  `source`.`stream_id`\nORDER BY\n  count DESC;",
          "refId": "A"
        }
      ],
      "title": "Error Count by Type w/ Stream Id",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This table displays the number of errors for each type that is being reported.\n\nGreen = below 20 errors\nYellow = 20 - 50 errors\nRed = > 50 errors\n",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "axisBorderShow": true,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#EAB839",
                "value": 20
              },
              {
                "color": "red",
                "value": 50
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 8,
        "x": 16,
        "y": 41
      },
      "id": 42,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "colorByField": "count",
        "fullHighlight": true,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "table",
          "placement": "right",
          "showLegend": false
        },
        "orientation": "horizontal",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 100
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.8.2",
          "queryType": "table",
          "rawSql": "SELECT\n  `source`.`short_message` AS `short_message`,\n  COUNT(*) AS `count`\nFROM\n  (\n    SELECT\n      `network_events`.`stream_events`.`sub_type` AS `sub_type`,\n      `network_events`.`stream_events`.`timestamp_ts` AS `timestamp_ts`,\n      `network_events`.`stream_events`.`message` AS `message`,\n      `substring`(\n        `toString`(`network_events`.`stream_events`.`message`),\n        1,\n        70\n      ) AS `short_message`\n    FROM\n      `network_events`.`stream_events`\n    WHERE\n      `network_events`.`stream_events`.`sub_type` = 'error'\n      AND $__timeFilter(timestamp_ts)\n      AND pipeline = 'comfyui'\n  ) AS `source`\nWHERE\n  `source`.`short_message` != ''\nGROUP BY\n  `source`.`short_message`\nORDER BY\n  count DESC;",
          "refId": "A"
        }
      ],
      "title": "Error Count by Type",
      "type": "barchart"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This chart displays the most recent events related to errors in the inference process.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 24,
        "x": 0,
        "y": 48
      },
      "id": 28,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT stream_id, timestamp_ts, event_type, pipeline, pipeline_id, message, gateway, type, capability, params, orchestrator_address, orchestrator_url\nFROM network_events.stream_events_view\nWHERE sub_type IN ('error', 'restart')\nAND stream_id IN (${stream_id:singlequote})\nAND $__timeFilter(timestamp_ts)\nAND pipeline = 'comfyui'\nORDER BY timestamp_ts DESC LIMIT 100;",
          "refId": "A"
        }
      ],
      "title": "Inference  Logs",
      "type": "table"
    },
    {
      "datasource": {
        "default": false,
        "type": "loki",
        "uid": "P8E80F9AEF21F6940"
      },
      "description": "Log information of all the streams of selected streams during the inference process. Using {container=\"live-video-to-video_comfyui_8900\"}",
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 55
      },
      "id": 31,
      "options": {
        "dedupStrategy": "none",
        "enableInfiniteScrolling": false,
        "enableLogDetails": true,
        "prettifyLogMessage": true,
        "showCommonLabels": true,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "P8E80F9AEF21F6940"
          },
          "editorMode": "code",
          "expr": "{container=\"live-video-to-video_comfyui_8900\"} |~ \"${stream_id}\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "title": "Inference Stream Logs",
      "type": "logs"
    },
    {
      "datasource": {
        "default": false,
        "type": "grafana-clickhouse-datasource",
        "uid": "cdrta4zbtlddsa"
      },
      "description": "This table contains information on the stream and the pipeline it is using.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Streams__from_playground"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 187
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Streams__pipeline_params"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 190
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Streams__pipeline_id"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 185
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 55
      },
      "id": 29,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "11.6.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "editorType": "sql",
          "format": 1,
          "meta": {
            "builderOptions": {
              "columns": [],
              "database": "",
              "limit": 1000,
              "mode": "list",
              "queryType": "table",
              "table": ""
            }
          },
          "pluginVersion": "4.9.0",
          "queryType": "table",
          "rawSql": "SELECT\n    stream_status_view.stream_id,\n    timestamp_ts,\n    Streams.id AS `Streams__id`,\n    Streams.output_playback_id AS `Streams__output_playback_id`,\n    Streams.author AS `Streams__author`,\n    Streams.stream_key AS `Streams__stream_key`,\n    Streams.created_at AS `Streams__created_at`,\n    Streams.gateway_host AS `Streams__gateway_host`,\n    Pipelines.id AS `Pipelines__id`,\n    Pipelines.name AS `Pipelines__name`,\n    Pipelines.description AS `Pipelines__description`,\n    Pipelines.author AS `Pipelines__author`,\n    Pipelines.type AS `Pipelines__type`,\n    Pipelines.created_at AS `Pipelines__created_at`,\n    Pipelines.updated_at AS `Pipelines__updated_at`\nFROM network_events.stream_status_view\n    LEFT JOIN network_events.daydream_streams_latest_view AS Streams ON stream_status_view.stream_id = Streams.id\n    LEFT JOIN network_events.daydream_pipelines_latest_table AS Pipelines ON stream_status_view.pipeline_id = Pipelines.id\n    LEFT JOIN network_events.daydream_users_latest_table AS `Users - Author` ON Pipelines.author = `Users - Author`.id\nWHERE $__timeFilter(timestamp_ts) \nAND stream_status_view.stream_id IN (${stream_id:singlequote})\nAND pipeline = 'comfyui'\nORDER BY timestamp_ts ASC;",
          "refId": "A"
        }
      ],
      "title": "Stream's Pipeline Data",
      "type": "table"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 63
      },
      "id": 33,
      "panels": [
        {
          "datasource": {
            "default": false,
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "description": "This chart visualizes the counts of 'restart' and 'error' events occurring in a stream over time\n\nRestart Count: This metric indicates the number of times a 'restart' event occurred within the specified minute. A higher count may suggest frequent restarts, which could indicate potential issues with service stability or performance.\n\nError Count: This metric represents the number of 'error' events logged during the same minute. An increase in error counts may signal underlying problems that require investigation, such as system failures or misconfigurations.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "# of Counts",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "dark-green"
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Restart_Count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-red",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Error_Count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-yellow",
                      "mode": "fixed"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 6,
            "w": 6,
            "x": 0,
            "y": 658
          },
          "id": 18,
          "options": {
            "legend": {
              "calcs": [
                "lastNotNull"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "grafana-clickhouse-datasource",
                "uid": "cdrta4zbtlddsa"
              },
              "editorType": "sql",
              "format": 1,
              "meta": {
                "builderOptions": {
                  "columns": [],
                  "database": "",
                  "limit": 1000,
                  "mode": "list",
                  "queryType": "table",
                  "table": ""
                }
              },
              "pluginVersion": "4.8.0",
              "queryType": "table",
              "rawSql": "SELECT toStartOfMinute(se.timestamp_ts) AS timestamp_ts, se.stream_id, ss.state, sum(se.restart_count) AS Restart_Count, countIf(se.sub_type = 'error') AS Error_Count\nFROM network_events.stream_events AS se\nJOIN network_events.stream_status AS ss ON se.stream_id = ss.stream_id\nWHERE se.stream_id IN (${stream_id:singlequote})\nAND $__timeFilter(se.timestamp_ts)\nGROUP BY timestamp_ts, se.stream_id, ss.state\nORDER BY timestamp_ts ASC;",
              "refId": "A"
            }
          ],
          "title": "Stream Health",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "Shows how much electricity the GPU is consuming - higher usage indicates more intensive workloads.\nNormal Load: <400W (for non-overclocked GPUs).\n\nHigh Load: 400â€“450W (expected under heavy workloads).",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 25,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "normal"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "red",
                    "value": 350
                  },
                  {
                    "color": "dark-red",
                    "value": 450
                  }
                ]
              },
              "unit": "watt"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 9,
            "x": 6,
            "y": 658
          },
          "id": 24,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "DCGM_FI_DEV_POWER_USAGE{Hostname=~\"${Hostname:regex}\"}",
              "instant": false,
              "legendFormat": "{{node_name}}/{{UUID}}/{{modelName}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GPU Power Usage ",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "Indicates how hot the GPU is running. 75Â°C is set as the warning  and â‰¥85Â°C should be alerted. Below 5Â°C should also indicate an issue.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "area"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "transparent"
                  },
                  {
                    "color": "dark-blue",
                    "value": 0
                  },
                  {
                    "color": "transparent",
                    "value": 5
                  },
                  {
                    "color": "light-red",
                    "value": 75
                  },
                  {
                    "color": "dark-red",
                    "value": 85
                  }
                ]
              },
              "unit": "celsius"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 9,
            "x": 15,
            "y": 658
          },
          "id": 23,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "DCGM_FI_DEV_GPU_TEMP{Hostname=~\"${Hostname:regex}\"}\n",
              "instant": false,
              "legendFormat": "{{node_name}}/{{modelName}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GPU Temperature >75Â°C - Celsius",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "2520 MHz (Boost Clock Speed):\nThis is the maximum clock speed that the GPU can achieve under optimal conditions, known as the boost clock speed. It represents the peak performance capability of the RTX 4090 when the GPU is under heavy load and has adequate cooling and power supply. Monitoring this value helps us understand the upper limits of the GPU's performance during demanding tasks.\n\n2235 MHz (Base Clock Speed):\nThis is the minimum clock speed at which the GPU operates under normal conditions. The base clock speed indicates the performance level the GPU should maintain during standard workloads. If the SM clock speed consistently operates at or near this value, it is functioning as expected. Monitoring this value helps ensure that the GPU is performing adequately during typical usage scenarios.\n\n2000 MHz (Threshold for Concern):\nThis is the threshold we have set to identify potential performance issues. If the SM clock speed drops below 2000 MHz during demanding tasks, it may indicate that the GPU is experiencing problems such as thermal throttling (overheating), power limitations, or other issues that could affect performance. Monitoring for values below this threshold allows us to take proactive measures to investigate and resolve any underlying issues before they impact the overall performance of the GPU.\n\nNote: The mean value on the chart should also be taking a close look at. Drop below 2000 MHz during demanding tasks may indicate issues such as thermal throttling, power limitations, or driver problems",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "line+area"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red"
                  },
                  {
                    "color": "dark-green",
                    "value": 2000
                  },
                  {
                    "color": "#EAB839",
                    "value": 2235
                  },
                  {
                    "color": "dark-red",
                    "value": 2520
                  }
                ]
              },
              "unit": "rotmhz"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 664
          },
          "id": 35,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "last"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "avg(DCGM_FI_DEV_SM_CLOCK) by (region, Hostname)",
              "legendFormat": "{{region}}-{{Hostname}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "SM Clock Speed",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This indicates the utilization of the GPU's Encoding/Decoding resources\n\nIf the encoding/decoding utilization is consistently near 100%, it may indicate that the GPU is being overutilized.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 664
          },
          "id": 36,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "rate(DCGM_FI_DEV_ENC_UTIL[1m])",
              "instant": false,
              "legendFormat": "{{region}}-Encode",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "rate(DCGM_FI_DEV_DEC_UTIL[1m])",
              "hide": false,
              "instant": false,
              "legendFormat": "{{region}}-Decode",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "GPU Encode/Decode Utilization",
          "type": "timeseries"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This displays the current amount of free framebuffer memory available on the GPU.\n\nGreen = > 90%\nYellow = > 60%\nRed = > 50%",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "fieldMinMax": false,
              "mappings": [],
              "min": 0,
              "thresholds": {
                "mode": "percentage",
                "steps": [
                  {
                    "color": "dark-red"
                  },
                  {
                    "color": "red",
                    "value": 50
                  },
                  {
                    "color": "#EAB839",
                    "value": 60
                  },
                  {
                    "color": "green",
                    "value": 90
                  }
                ]
              },
              "unit": "mbytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 672
          },
          "id": 37,
          "options": {
            "displayMode": "gradient",
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "maxVizHeight": 300,
            "minVizHeight": 15,
            "minVizWidth": 8,
            "namePlacement": "left",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showUnfilled": true,
            "sizing": "auto",
            "valueMode": "color"
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "DCGM_FI_DEV_FB_FREE",
              "instant": false,
              "legendFormat": "{{Hostname}}",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "",
              "hide": false,
              "instant": false,
              "legendFormat": "__auto",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "GPU Free Memory not in use",
          "type": "bargauge"
        },
        {
          "datasource": {
            "default": true,
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "This measures the total capacity of the GPU.\n",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "thresholds"
              },
              "fieldMinMax": false,
              "mappings": [],
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "mbytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 672
          },
          "id": 38,
          "options": {
            "displayMode": "gradient",
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "maxVizHeight": 300,
            "minVizHeight": 15,
            "minVizWidth": 8,
            "namePlacement": "auto",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showUnfilled": true,
            "sizing": "auto",
            "valueMode": "color"
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "(DCGM_FI_DEV_FB_FREE + DCGM_FI_DEV_FB_USED)",
              "instant": false,
              "legendFormat": "{{Hostname}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GPU Max Capacity",
          "type": "bargauge"
        },
        {
          "datasource": {
            "default": false,
            "type": "grafana-clickhouse-datasource",
            "uid": "cdrta4zbtlddsa"
          },
          "description": "This chart displays the average number of streams based on the timestamp.\n",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 0,
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 5,
            "x": 0,
            "y": 680
          },
          "id": 19,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "mean"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "11.5.2",
          "targets": [
            {
              "datasource": {
                "type": "grafana-clickhouse-datasource",
                "uid": "cdrta4zbtlddsa"
              },
              "editorType": "sql",
              "format": 1,
              "hide": false,
              "meta": {
                "builderOptions": {
                  "columns": [],
                  "database": "",
                  "limit": 1000,
                  "mode": "list",
                  "queryType": "table",
                  "table": ""
                }
              },
              "pluginVersion": "4.8.0",
              "queryType": "table",
              "rawSql": "SELECT AVG(stream_count) as avg_active_streams\nFROM (\n    SELECT \n        toStartOfMinute(timestamp_ts) as minute,\n        COUNT(DISTINCT stream_id) as stream_count\n    FROM network_events.stream_status\n    WHERE state = 'ONLINE' AND $__timeFilter(timestamp_ts)\n    GROUP BY minute\n) subquery;",
              "refId": "B"
            }
          ],
          "title": "Average Streams Online",
          "type": "stat"
        }
      ],
      "title": "Additional Dashboards",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 64
      },
      "id": 46,
      "panels": [],
      "title": "Tracking Changes",
      "type": "row"
    }
  ],
  "preload": false,
  "refresh": "",
  "schemaVersion": 41,
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "cdrta4zbtlddsa"
        },
        "definition": "SELECT DISTINCT stream_id \nFROM network_events.stream_events \nWHERE $__timeFilter(timestamp_ts)",
        "includeAll": true,
        "label": "Stream Id",
        "name": "stream_id",
        "options": [],
        "query": "SELECT DISTINCT stream_id \nFROM network_events.stream_events \nWHERE $__timeFilter(timestamp_ts)",
        "refresh": 2,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "cdrta4zbtlddsa"
        },
        "definition": "SELECT DISTINCT Streams.stream_key\nFROM network_events.stream_events\nLEFT JOIN network_events.streams AS Streams ON stream_events.stream_id = Streams.id\nWHERE $__timeFilter(timestamp_ts);",
        "includeAll": true,
        "label": "Stream Key",
        "name": "stream_key",
        "options": [],
        "query": "SELECT DISTINCT Streams.stream_key\nFROM network_events.stream_events\nLEFT JOIN network_events.streams AS Streams ON stream_events.stream_id = Streams.id\nWHERE $__timeFilter(timestamp_ts);",
        "refresh": 2,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "prometheus",
          "uid": "PBFA97CFB590B2093"
        },
        "definition": "label_values(node_cpu_seconds_total{region=~\".*-ai$\"}, region)",
        "includeAll": true,
        "label": "Ingest Region",
        "name": "region",
        "options": [],
        "query": {
          "qryType": 5,
          "query": "label_values(node_cpu_seconds_total{region=~\".*-ai$\"}, region)",
          "refId": "PrometheusVariableQueryEditor-VariableQuery"
        },
        "refresh": 1,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "prometheus",
          "uid": "PBFA97CFB590B2093"
        },
        "definition": "label_values(DCGM_FI_DEV_FB_USED, Hostname)",
        "includeAll": true,
        "label": "Inference Region",
        "multi": true,
        "name": "Hostname",
        "options": [],
        "query": {
          "qryType": 5,
          "query": "label_values(DCGM_FI_DEV_FB_USED, Hostname)",
          "refId": "PrometheusVariableQueryEditor-VariableQuery"
        },
        "refresh": 1,
        "regex": "",
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-3h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "utc",
  "title": "Ai Monitoring",
  "uid": "becrwydm8kpvke",
  "version": 13
}
